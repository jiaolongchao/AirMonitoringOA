<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta http-equiv="X-UA-Compatible" content="IE=emulateIE7" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" type="text/css" href="css/style.css" />
    <link rel="stylesheet" type="text/css" href="css/skin_/index.css" />
    <script type="text/javascript" src="js/jquery.js"></script>
    <script type="text/javascript" src="js/global.js"></script>
    <script type="text/javascript" src="js/jquery-ui-1.9.2.custom.min.js"></script>
    <title>首页</title>
</head>

<body>
    <div id="container">
        <div id="hd">
        </div>
        <div id="bd">
            <div id="main">
                <ul class="content-list">

                    <li class="content-item dothings">
                        <h2 class="content-hd">
                            <!-- <span class="opt">
                        	<span class="refresh" title="刷新"></span>
                            <span class="setting" title="设置"></span>
                            <span class="report" title="导出"></span>
                            <span class="close" title="关闭"></span>
                        </span> -->
                            <span class="title">文章列表</span>
                        </h2>
                        <div class="content-bd" style="height:auto">
                            <ul class="content-list things" id="content-list">

                            </ul>
                        </div>
                    </li>

                </ul>
            </div>
        </div>
    </div>
</body>
<script type="text/javascript">
    var minwidth = 282;
    //resizeWidth();
    $(top.window).resize(function (e) {
        //resizeWidth();
    });
    $(function () {
        $(".content-list").sortable({
            revert: true,
            handle: 'h2'
        });
    });

    function resizeWidth() { //窗口改变
        if ($('#main').width() / 3 < minwidth) {
            $('.content-item').width(($('#main').width() / 2) - 15);
        } else {
            $('.content-item').width(($('#main').width() / 3) - 15);
        }
    }
    function getList() {//获取文章列表
        $.ajax({
            url: window.HTTP_URL + 'air/news/list',
            type: 'get',
            success: function (res) {
                var data = res.data;
                if (res.code == 200) {
                    var html = '';
                    for (var i = 0; i < data.length; i++) {
                        html += '<li class="content-list-item" data-id="' + data[i].id + '" data-index = ' + data[i].id + '><i class="icon"></i>' + data[i].title +
                            '<span class="con-operation"><span class="addTable">添加/修改</span><span class="editArticle">编辑</span><span class="delArticle">删除</span></span>' +
                            '</li>'
                    }
                    $('#content-list').html(html)
                    delArticle()
                }
            },
            error: function (err) {
                console.log(err)
            }
        })
    }
    getList();//获取文章列表

    function removeList(id) { //删除文章
        $.ajax({
            url: window.HTTP_URL + 'air/news/del',
            type: 'post',
            data: {
                id: id
            },
            success: function (res) {
                var data = res.data;
                if (res.code == 200) {
                    console.log(res, '删除成功')
                }
            },
            error: function (err) {
                console.log(err, '删除失败')
            }
        })
    }

    function delArticle() {
        $('#content-list li').bind('click', function (env) {
            var id = $(this).attr('data-id');
            if ($(env.target).hasClass('delArticle')) { // 删除
                removeList(id);//删除文章
                $(this).remove();
            } else if ($(env.target).hasClass('editArticle')) { //编辑
                $(window.parent.document).find('#editLi').trigger("click"); //跳转到发布文章的页面
                //$(parent.frames["m2"]).find('#addArticle').trigger('click','edit',id);
                parent.frames["m6"].articlId = id;
            } else if ($(env.target).hasClass('addTable')) { //添加检测数据
                hasdata(id, function (flag) {
                    console.log("hasdata", flag);
                    if (flag) { //flag为true时表示有检测数据 跳编辑
                        $(window.parent.document).find('#editTable').trigger("click"); //跳转到添加检测数据页面
                        parent.frames["m7"].articlId = id;
                    } else {//flag为false时表示有检测数据 跳添加
                        $(window.parent.document).find('#addTable').trigger("click"); //跳转到添加检测数据页面
                        parent.frames["m3"].articlId = id;
                    }
                })
                
            }
        })
    }

    function hasdata(id, fun) {
        $.ajax({
            url: window.HTTP_URL + 'air/monitordata/hasdata',
            type: 'get',
            data: {
                newsid: id
            },
            success: function (res) {
                var data = res.data;
                if (res.code == 200) {
                    fun(res.data)
                }
            },
            error: function (err) {
                console.log(err, 'hasdataError')
            }
        })
    }

</script>

</html>